package fixed56

import "testing"

var bincdfTestCases_100 = []BinCDFCase{
	{
		n:   91,
		x:   10,
		p:   0.10500215104453339,
		cdf: 0.6417765472300323,
		s:   "+0'a44b77c1b15a90/56",
	},
	{
		n:   91,
		x:   62,
		p:   0.44897837076069524,
		cdf: 0.9999976129971369,
		s:   "+0'ffffd7f3e698b0/56",
	},
	{
		n:   91,
		x:   34,
		p:   0.5472942428328025,
		cdf: 0.0006417729711287991,
		s:   "+0'002a0f29ec2601/56",
	},
	{
		n:   91,
		x:   81,
		p:   0.5481335489335352,
		cdf: 0.9999999999997258,
		s:   "+0'ffffffffffb2d0/56",
	},
	{
		n:   91,
		x:   74,
		p:   0.7173877665258833,
		cdf: 0.986910611943529,
		s:   "+0'fca62c825f7018/56",
	},
	{
		n:   64,
		x:   6,
		p:   0.10595944388761408,
		cdf: 0.4760310219506413,
		s:   "+0'79dd2b4728d288/56",
	},
	{
		n:   64,
		x:   45,
		p:   0.446532178678148,
		cdf: 0.999990449263827,
		s:   "+0'ffff5fc3e68620/56",
	},
	{
		n:   64,
		x:   40,
		p:   0.4053071939367727,
		cdf: 0.9998774136214171,
		s:   "+0'fff7f757835758/56",
	},
	{
		n:   64,
		x:   48,
		p:   0.5432039225844807,
		cdf: 0.9998033587600839,
		s:   "+0'fff31ce84e3640/56",
	},
	{
		n:   64,
		x:   53,
		p:   0.8089882961206434,
		cdf: 0.7000057795262447,
		s:   "+0'b333942a138250/56",
	},
	{
		n:   38,
		x:   6,
		p:   0.21785313677518178,
		cdf: 0.24871118805496217,
		s:   "+0'3fab8952d86a10/56",
	},
	{
		n:   38,
		x:   19,
		p:   0.5517614734259535,
		cdf: 0.3148808064381218,
		s:   "+0'509c074dca32e8/56",
	},
	{
		n:   38,
		x:   14,
		p:   0.5396278789976454,
		cdf: 0.025314053476267577,
		s:   "+0'067afb57cf4cb7/56",
	},
	{
		n:   38,
		x:   29,
		p:   0.45557426833432835,
		cdf: 0.9999727861704804,
		s:   "+0'fffe376d7e01c0/56",
	},
	{
		n:   38,
		x:   34,
		p:   0.8914426144413563,
		cdf: 0.6028815419646607,
		s:   "+0'9a5671da19ab40/56",
	},
	{
		n:   53,
		x:   5,
		p:   0.11854916867602958,
		cdf: 0.38890226490558305,
		s:   "+0'638f194d1c1c5c/56",
	},
	{
		n:   53,
		x:   29,
		p:   0.47179587609692575,
		cdf: 0.8918491680152445,
		s:   "+0'e4503a21971ce0/56",
	},
	{
		n:   53,
		x:   28,
		p:   0.5207452062733783,
		cdf: 0.5969353875714873,
		s:   "+0'98d0c1ef71d2d0/56",
	},
	{
		n:   53,
		x:   35,
		p:   0.5459463573387636,
		cdf: 0.9662240331804673,
		s:   "+0'f75a754f1e8c28/56",
	},
	{
		n:   53,
		x:   44,
		p:   0.7249652325706419,
		cdf: 0.9741845140848678,
		s:   "+0'f9642804439fe8/56",
	},
	{
		n:   58,
		x:   5,
		p:   0.21040812625464542,
		cdf: 0.01009886537221305,
		s:   "+0'0295d6d88017b8/56",
	},
	{
		n:   58,
		x:   55,
		p:   0.5257279598988888,
		cdf: 0.999999999999911,
		s:   "+0'ffffffffffe6f0/56",
	},
	{
		n:   58,
		x:   30,
		p:   0.5154704290513524,
		cdf: 0.5622977383912134,
		s:   "+0'8ff2be9d014958/56",
	},
	{
		n:   58,
		x:   40,
		p:   0.40916487673113244,
		cdf: 0.9999956702612344,
		s:   "+0'ffffb75be9e1c8/56",
	},
	{
		n:   58,
		x:   52,
		p:   0.8546136681577384,
		cdf: 0.8655372471371283,
		s:   "+0'dd93d959ec8080/56",
	},
	{
		n:   20,
		x:   2,
		p:   0.273296733351054,
		cdf: 0.05971351615650333,
		s:   "+0'0f49628f057728/56",
	},
	{
		n:   20,
		x:   16,
		p:   0.45559472062201845,
		cdf: 0.9996672891391021,
		s:   "+0'ffea3209bbc160/56",
	},
	{
		n:   20,
		x:   11,
		p:   0.5668220853281501,
		cdf: 0.5252167978800542,
		s:   "+0'86749baa346590/56",
	},
	{
		n:   20,
		x:   13,
		p:   0.47403619342337655,
		cdf: 0.9646955446392785,
		s:   "+0'f6f64986d29688/56",
	},
	{
		n:   20,
		x:   18,
		p:   0.8340350348755388,
		cdf: 0.8679013186269016,
		s:   "+0'de2ec7e3a866c0/56",
	},
	{
		n:   99,
		x:   10,
		p:   0.22182620113339765,
		cdf: 0.0014360997475819258,
		s:   "+0'005e1dc1731ccd/56",
	},
	{
		n:   99,
		x:   59,
		p:   0.5068279754059416,
		cdf: 0.969915439981393,
		s:   "+0'f84c60d69b0440/56",
	},
	{
		n:   99,
		x:   48,
		p:   0.4326804987523857,
		cdf: 0.8745129743166937,
		s:   "+0'dfe015109e2de0/56",
	},
	{
		n:   99,
		x:   90,
		p:   0.45398956535685564,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   99,
		x:   82,
		p:   0.7439230347940539,
		cdf: 0.9826683762252783,
		s:   "+0'fb90279ab37458/56",
	},
	{
		n:   51,
		x:   5,
		p:   0.1458096143928209,
		cdf: 0.22713350902031348,
		s:   "+0'3a256bf1116650/56",
	},
	{
		n:   51,
		x:   26,
		p:   0.561009160154243,
		cdf: 0.2746272414096259,
		s:   "+0'464df88c71ee28/56",
	},
	{
		n:   51,
		x:   29,
		p:   0.45354817519514057,
		cdf: 0.9631332766555709,
		s:   "+0'f68fe704eccca0/56",
	},
	{
		n:   51,
		x:   40,
		p:   0.582627224837109,
		cdf: 0.9992801354556762,
		s:   "+0'ffd0d2ad5317a0/56",
	},
	{
		n:   51,
		x:   42,
		p:   0.8752735252945338,
		cdf: 0.17916447284220272,
		s:   "+0'2dddb90f765bf8/56",
	},
	{
		n:   50,
		x:   6,
		p:   0.23108773305897598,
		cdf: 0.03824588242065498,
		s:   "+0'09ca7b6e341059/56",
	},
	{
		n:   50,
		x:   37,
		p:   0.5769366307773406,
		cdf: 0.9944880768108142,
		s:   "+0'fe96c5462a1500/56",
	},
	{
		n:   50,
		x:   30,
		p:   0.4285743180884125,
		cdf: 0.9950354524826084,
		s:   "+0'febaa4b6c5fb40/56",
	},
	{
		n:   50,
		x:   36,
		p:   0.4493255015387967,
		cdf: 0.9999709753437687,
		s:   "+0'fffe190c0cfb40/56",
	},
	{
		n:   50,
		x:   41,
		p:   0.8077954579334582,
		cdf: 0.6427940667842773,
		s:   "+0'a48e26e6e6bc50/56",
	},
	{
		n:   84,
		x:   14,
		p:   0.2795645767204954,
		cdf: 0.011564127219758098,
		s:   "+0'02f5dddc373479/56",
	},
	{
		n:   84,
		x:   67,
		p:   0.4723992887427222,
		cdf: 0.9999999997938667,
		s:   "+0'ffffffff1d5aa0/56",
	},
	{
		n:   84,
		x:   32,
		p:   0.5019052587352929,
		cdf: 0.017221932699812828,
		s:   "+0'0468a815b8384d/56",
	},
	{
		n:   84,
		x:   58,
		p:   0.5511564315067475,
		cdf: 0.9967234306120473,
		s:   "+0'ff294449a2bb28/56",
	},
	{
		n:   84,
		x:   75,
		p:   0.7305682638696522,
		cdf: 0.9999280451613721,
		s:   "+0'fffb48cc524100/56",
	},
	{
		n:   100,
		x:   1,
		p:   0.1,
		cdf: 0.00032168805319411544,
		s:   "+0'00151507ab00e8/56",
	},
	{
		n:   100,
		x:   11,
		p:   0.1,
		cdf: 0.7030331002887541,
		s:   "+0'b3f9fa2dbee558/56",
	},
	{
		n:   100,
		x:   21,
		p:   0.1,
		cdf: 0.9996880819950115,
		s:   "+0'ffeb8ee25e9a38/56",
	},
	{
		n:   100,
		x:   31,
		p:   0.1,
		cdf: 0.9999999985704736,
		s:   "+0'fffffff9dc3818/56",
	},
	{
		n:   100,
		x:   41,
		p:   0.1,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   100,
		x:   51,
		p:   0.1,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   100,
		x:   61,
		p:   0.1,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   100,
		x:   71,
		p:   0.1,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   100,
		x:   81,
		p:   0.1,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   100,
		x:   91,
		p:   0.1,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   100,
		x:   1,
		p:   0.2,
		cdf: 5.296293538469694e-09,
		s:   "+0'00000016bf5619/56",
	},
	{
		n:   100,
		x:   11,
		p:   0.2,
		cdf: 0.01257487634812179,
		s:   "+0'03381b6aaa9af5/56",
	},
	{
		n:   100,
		x:   21,
		p:   0.2,
		cdf: 0.65403321802466,
		s:   "+0'a76eb891e9de90/56",
	},
	{
		n:   100,
		x:   31,
		p:   0.2,
		cdf: 0.9968703018318312,
		s:   "+0'ff32e460b8ab50/56",
	},
	{
		n:   100,
		x:   41,
		p:   0.2,
		cdf: 0.9999995552191245,
		s:   "+0'fffff889ae4170/56",
	},
	{
		n:   100,
		x:   51,
		p:   0.2,
		cdf: 0.9999999999987937,
		s:   "+0'fffffffffeac78/56",
	},
	{
		n:   100,
		x:   61,
		p:   0.2,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   100,
		x:   71,
		p:   0.2,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   100,
		x:   81,
		p:   0.2,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   100,
		x:   91,
		p:   0.2,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   100,
		x:   1,
		p:   0.3,
		cdf: 1.4185489835068493e-14,
		s:   "+0'000000000003fe/56",
	},
	{
		n:   100,
		x:   11,
		p:   0.3,
		cdf: 5.659628935841608e-06,
		s:   "+0'00005ef3ebd2e8/56",
	},
	{
		n:   100,
		x:   21,
		p:   0.3,
		cdf: 0.028831253120606814,
		s:   "+0'07617c294175d4/56",
	},
	{
		n:   100,
		x:   31,
		p:   0.3,
		cdf: 0.6331079860140434,
		s:   "+0'a2135d6ec44930/56",
	},
	{
		n:   100,
		x:   41,
		p:   0.3,
		cdf: 0.9928264374006265,
		s:   "+0'fe29df973d68e8/56",
	},
	{
		n:   100,
		x:   51,
		p:   0.3,
		cdf: 0.9999964385184814,
		s:   "+0'ffffc43f8da880/56",
	},
	{
		n:   100,
		x:   61,
		p:   0.3,
		cdf: 0.9999999999622746,
		s:   "+0'ffffffffd68540/56",
	},
	{
		n:   100,
		x:   71,
		p:   0.3,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   100,
		x:   81,
		p:   0.3,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   100,
		x:   91,
		p:   0.3,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   100,
		x:   1,
		p:   0.4,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   11,
		p:   0.4,
		cdf: 1.303610288705923e-10,
		s:   "+0'000000008f555e/56",
	},
	{
		n:   100,
		x:   21,
		p:   0.4,
		cdf: 4.315613913993232e-05,
		s:   "+0'0002d40a34cb55/56",
	},
	{
		n:   100,
		x:   31,
		p:   0.4,
		cdf: 0.03984788423484439,
		s:   "+0'0a33788f9a7bbd/56",
	},
	{
		n:   100,
		x:   41,
		p:   0.4,
		cdf: 0.6225326761221723,
		s:   "+0'9f5e4d2ca2d6d0/56",
	},
	{
		n:   100,
		x:   51,
		p:   0.4,
		cdf: 0.989994856800007,
		s:   "+0'fd704d8d2a0b30/56",
	},
	{
		n:   100,
		x:   61,
		p:   0.4,
		cdf: 0.9999926361002475,
		s:   "+0'ffff84744a98a8/56",
	},
	{
		n:   100,
		x:   71,
		p:   0.4,
		cdf: 0.9999999999085238,
		s:   "+0'ffffffff9b6bc0/56",
	},
	{
		n:   100,
		x:   81,
		p:   0.4,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   100,
		x:   91,
		p:   0.4,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   100,
		x:   1,
		p:   0.5,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   11,
		p:   0.5,
		cdf: 1.2704266677461526e-16,
		s:   "+0'00000000000009/56",
	},
	{
		n:   100,
		x:   21,
		p:   0.5,
		cdf: 2.168683316710818e-09,
		s:   "+0'00000009507e16/56",
	},
	{
		n:   100,
		x:   31,
		p:   0.5,
		cdf: 9.157161244117676e-05,
		s:   "+0'0006005114a73c/56",
	},
	{
		n:   100,
		x:   41,
		p:   0.5,
		cdf: 0.04431304005703377,
		s:   "+0'0b581971d4cff2/56",
	},
	{
		n:   100,
		x:   51,
		p:   0.5,
		cdf: 0.6178232827986667,
		s:   "+0'9e29aaaa53dfc0/56",
	},
	{
		n:   100,
		x:   61,
		p:   0.5,
		cdf: 0.9895106321610742,
		s:   "+0'fd50919c2d14d8/56",
	},
	{
		n:   100,
		x:   71,
		p:   0.5,
		cdf: 0.9999937104249916,
		s:   "+0'ffff967a7b2500/56",
	},
	{
		n:   100,
		x:   81,
		p:   0.5,
		cdf: 0.9999999999692609,
		s:   "+0'ffffffffde33b8/56",
	},
	{
		n:   100,
		x:   91,
		p:   0.5,
		cdf: 0.9999999999999999,
		s:   "+0'fffffffffffff8/56",
	},
	{
		n:   100,
		x:   1,
		p:   0.6,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   11,
		p:   0.6,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   21,
		p:   0.6,
		cdf: 1.9786248692975222e-15,
		s:   "+0'0000000000008e/56",
	},
	{
		n:   100,
		x:   31,
		p:   0.6,
		cdf: 4.316989769914781e-09,
		s:   "+0'000000128a9498/56",
	},
	{
		n:   100,
		x:   41,
		p:   0.6,
		cdf: 9.608207526190542e-05,
		s:   "+0'00064bfd5ef8a8/56",
	},
	{
		n:   100,
		x:   51,
		p:   0.6,
		cdf: 0.04230142018913792,
		s:   "+0'0ad44410496545/56",
	},
	{
		n:   100,
		x:   61,
		p:   0.6,
		cdf: 0.617812342716765,
		s:   "+0'9e28f31f089d40/56",
	},
	{
		n:   100,
		x:   71,
		p:   0.6,
		cdf: 0.9915674665560195,
		s:   "+0'fdd75d90a2bbc0/56",
	},
	{
		n:   100,
		x:   81,
		p:   0.6,
		cdf: 0.9999980188797241,
		s:   "+0'ffffdec3273878/56",
	},
	{
		n:   100,
		x:   91,
		p:   0.6,
		cdf: 0.9999999999994569,
		s:   "+0'ffffffffff6720/56",
	},
	{
		n:   100,
		x:   1,
		p:   0.7,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   11,
		p:   0.7,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   21,
		p:   0.7,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   31,
		p:   0.7,
		cdf: 1.0750477912133276e-15,
		s:   "+0'0000000000004d/56",
	},
	{
		n:   100,
		x:   41,
		p:   0.7,
		cdf: 1.779843826758552e-09,
		s:   "+0'00000007a4f57f/56",
	},
	{
		n:   100,
		x:   51,
		p:   0.7,
		cdf: 5.185947212459022e-05,
		s:   "+0'0003660ebc9c7e/56",
	},
	{
		n:   100,
		x:   61,
		p:   0.7,
		cdf: 0.0339789982689314,
		s:   "+0'08b2d8fe50dee3/56",
	},
	{
		n:   100,
		x:   71,
		p:   0.7,
		cdf: 0.6232218207837931,
		s:   "+0'9f8b771a6b82c8/56",
	},
	{
		n:   100,
		x:   81,
		p:   0.7,
		cdf: 0.9954773607768684,
		s:   "+0'fed79ab471ee58/56",
	},
	{
		n:   100,
		x:   91,
		p:   0.7,
		cdf: 0.9999999149592074,
		s:   "+0'fffffe92c0a8e0/56",
	},
	{
		n:   100,
		x:   1,
		p:   0.8,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   11,
		p:   0.8,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   21,
		p:   0.8,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   31,
		p:   0.8,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   41,
		p:   0.8,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   51,
		p:   0.8,
		cdf: 8.49713850131398e-11,
		s:   "+0'000000005d6d51/56",
	},
	{
		n:   100,
		x:   61,
		p:   0.8,
		cdf: 9.683792892427835e-06,
		s:   "+0'0000a27792e2dd/56",
	},
	{
		n:   100,
		x:   71,
		p:   0.8,
		cdf: 0.020020206732172394,
		s:   "+0'05200b552c80be/56",
	},
	{
		n:   100,
		x:   81,
		p:   0.8,
		cdf: 0.6379129161663627,
		s:   "+0'a34e42c8a16998/56",
	},
	{
		n:   100,
		x:   91,
		p:   0.8,
		cdf: 0.9991446016377815,
		s:   "+0'ffc7f0cc025c38/56",
	},
	{
		n:   100,
		x:   1,
		p:   0.9,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   11,
		p:   0.9,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   21,
		p:   0.9,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   31,
		p:   0.9,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   41,
		p:   0.9,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   51,
		p:   0.9,
		cdf: 0,
		s:   "+0'00000000000000/56",
	},
	{
		n:   100,
		x:   61,
		p:   0.9,
		cdf: 1.7523832685902988e-14,
		s:   "+0'000000000004ee/56",
	},
	{
		n:   100,
		x:   71,
		p:   0.9,
		cdf: 9.44384837708984e-08,
		s:   "+0'000001959c3605/56",
	},
	{
		n:   100,
		x:   81,
		p:   0.9,
		cdf: 0.004580754180004476,
		s:   "+0'012c344d64e600/56",
	},
	{
		n:   100,
		x:   91,
		p:   0.9,
		cdf: 0.6791261116371596,
		s:   "+0'addb3577575be0/56",
	},
}

func Benchmark_Fixed_BinCDF_100(b *testing.B) {
	for i := 0; i < b.N; i++ {
		tc := bincdfTestCases_100[i%len(bincdfTestCases_100)]
		bincdfResultFix = BinCDF(tc.n, From(tc.p), tc.x)
	}

	bincdfResultFix.lo++
}

func Benchmark_Float_BinCDF_100(b *testing.B) {
	for i := 0; i < b.N; i++ {
		tc := bincdfTestCases_100[i%len(bincdfTestCases_100)]
		bincdfResultFlt = bincdf_(tc.n, tc.p, tc.x)
	}

	bincdfResultFlt++
}

func TestFixed_BinCDF_100(t *testing.T) {
	acc := accuracy{Epsilon: 1e-14}
	for i, tc := range bincdfTestCases_100 {
		p := From(tc.p)
		got := BinCDF(tc.n, p, tc.x)
		if ok := acc.update(got, tc.cdf); !ok {
			t.Errorf("%d: BinCDF(%v,%v,%v) => got %v|%v, want %v|%v", i, tc.n, tc.p, tc.x, got, got.Float(), From(tc.cdf), tc.cdf)
		}
	}
	t.Log(acc)
}
